{"version":3,"file":"static/js/490.8ec6aa14.chunk.js","mappings":"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","sources":["../node_modules/@arcgis/core/views/2d/engine/webgl/TileContainer.js","../node_modules/@arcgis/core/views/2d/engine/BitmapTile.js","../node_modules/@arcgis/core/views/2d/engine/BitmapTileContainer.js","../node_modules/@arcgis/core/views/2d/layers/BitmapTileLayerView2D.js","../node_modules/@arcgis/core/views/2d/layers/WMTSLayerView2D.js","../node_modules/@arcgis/core/views/2d/layers/support/imageUtils.js","../node_modules/@arcgis/core/views/layers/RefreshableLayerView.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.29/esri/copyright.txt for details.\n*/\nimport has from\"../../../../core/has.js\";import{WGLDrawPhase as e}from\"./enums.js\";import r from\"./WGLContainer.js\";import s from\"./brushes/WGLBrushStencil.js\";import t from\"./brushes/WGLBrushTileDebugInfo.js\";const n=(e,r)=>e.key.level-r.key.level!=0?e.key.level-r.key.level:e.key.row-r.key.row!=0?e.key.row-r.key.row:e.key.col-r.key.col;class i extends r{constructor(e){super(),this._tileInfoView=e}renderChildren(e){this.sortChildren(n),this.setStencilReference(e),super.renderChildren(e)}createRenderParams(e){const{state:r}=e,s=super.createRenderParams(e);return s.requiredLevel=this._tileInfoView.getClosestInfoForScale(r.scale).level,s.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(r.scale),s}prepareRenderPasses(r){const n=super.prepareRenderPasses(r);return n.push(r.registerRenderPass({name:\"stencil\",brushes:[s],drawPhase:e.DEBUG|e.MAP|e.HIGHLIGHT|e.LABEL,target:()=>this.getStencilTarget()})),has(\"esri-tiles-debug\")&&n.push(r.registerRenderPass({name:\"tileInfo\",brushes:[t],drawPhase:e.DEBUG,target:()=>this.children})),n}getStencilTarget(){return this.children}setStencilReference(e){let r=1;for(const s of this.children)s.stencilRef=r++}}export{i as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.29/esri/copyright.txt for details.\n*/\nimport{create as e}from\"../../../core/libs/gl-matrix-2/factories/mat3f32.js\";import{Bitmap as t}from\"./Bitmap.js\";import{TiledDisplayObject as s}from\"./webgl/TiledDisplayObject.js\";class r extends s{constructor(e,s,r,i,a,n,o=null){super(e,s,r,i,a,n),this.bitmap=new t(o),this.bitmap.coordScale=[a,n],this.bitmap.once(\"isReady\",(()=>this.ready()))}destroy(){super.destroy(),this.bitmap.destroy()}beforeRender(e){this.bitmap.beforeRender(e),super.beforeRender(e)}afterRender(e){this.bitmap.afterRender(e),super.afterRender(e)}set stencilRef(e){this.bitmap.stencilRef=e}get stencilRef(){return this.bitmap.stencilRef}_createTransforms(){return{displayViewScreenMat3:e(),tileMat3:e()}}setTransform(e){super.setTransform(e),this.bitmap.transforms.displayViewScreenMat3=this.transforms.displayViewScreenMat3}onAttach(){this.bitmap.stage=this.stage}onDetach(){this.bitmap&&(this.bitmap.stage=null)}}export{r as BitmapTile};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.29/esri/copyright.txt for details.\n*/\nimport{create as e}from\"../../../geometry/support/aaBoundingRect.js\";import{BitmapTile as i}from\"./BitmapTile.js\";import{brushes as r}from\"./brushes.js\";import{WGLDrawPhase as t}from\"./webgl/enums.js\";import s from\"./webgl/TileContainer.js\";class n extends s{get requiresDedicatedFBO(){return this.children.some((e=>\"additive\"===e.bitmap.blendFunction))}createTile(r){const t=this._tileInfoView.getTileBounds(e(),r),s=this._tileInfoView.getTileResolution(r.level),[n,o]=this._tileInfoView.tileInfo.size;return new i(r,s,t[0],t[3],n,o)}prepareRenderPasses(e){const i=e.registerRenderPass({name:\"bitmap (tile)\",brushes:[r.bitmap],target:()=>this.children.map((e=>e.bitmap)),drawPhase:t.MAP});return[...super.prepareRenderPasses(e),i]}doRender(e){this.visible&&e.drawPhase===t.MAP&&super.doRender(e)}}export{n as BitmapTileContainer};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.29/esri/copyright.txt for details.\n*/\nimport{_ as i}from\"../../../chunks/tslib.es6.js\";import\"../../../core/Logger.js\";import\"../../../core/has.js\";import\"../../../core/RandomLCG.js\";import\"../../../core/Error.js\";import{subclass as e}from\"../../../core/accessorSupport/decorators/subclass.js\";import{BitmapTileContainer as t}from\"../engine/BitmapTileContainer.js\";const r=r=>{let s=class extends r{attach(){this.view.timeline.record(`${this.layer.title} (BitmapTileLayer) Attach`),this._bitmapView=new t(this._tileInfoView),this.container.addChild(this._bitmapView)}detach(){this.container.removeChild(this._bitmapView),this._bitmapView?.removeAllChildren(),this._bitmapView=null}};return s=i([e(\"esri.views.2d.layers.BitmapTileLayerView2D\")],s),s};export{r as BitmapTileLayerView2D};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.29/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import t from\"../../../core/Logger.js\";import{isAbortError as i}from\"../../../core/promiseUtils.js\";import{property as s}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/has.js\";import\"../../../core/RandomLCG.js\";import{subclass as r}from\"../../../core/accessorSupport/decorators/subclass.js\";import{equals as a}from\"../../../geometry/support/spatialReferenceUtils.js\";import{BitmapTileLayerView2D as l}from\"./BitmapTileLayerView2D.js\";import{LayerView2DMixin as o}from\"./LayerView2D.js\";import{resampleImage as h}from\"./support/imageUtils.js\";import n from\"../tiling/TileInfoView.js\";import c from\"../tiling/TileKey.js\";import u from\"../tiling/TileQueue.js\";import f from\"../tiling/TileStrategy.js\";import p from\"../../layers/LayerView.js\";import d from\"../../layers/RefreshableLayerView.js\";const m=new Set([102113,102100,3857,3785,900913]),y=[0,0];let _=class extends(d(l(o(p)))){constructor(){super(...arguments),this._tileStrategy=null,this._fetchQueue=null,this.layer=null}get tileMatrixSet(){const e=this._getTileMatrixSetBySpatialReference(this.layer.activeLayer);return e?(e.id!==this.layer.activeLayer.tileMatrixSetId&&(this.layer.activeLayer.tileMatrixSetId=e.id),e):null}update(e){this._fetchQueue.pause(),this._fetchQueue.state=e.state,this._tileStrategy.update(e),this._fetchQueue.resume()}attach(){const e=this.tileMatrixSet?.tileInfo;e&&(this._tileInfoView=new n(e),this._fetchQueue=new u({tileInfoView:this._tileInfoView,concurrency:16,process:(e,t)=>this.fetchTile(e,t)}),this._tileStrategy=new f({cachePolicy:\"keep\",resampling:!0,acquireTile:e=>this.acquireTile(e),releaseTile:e=>this.releaseTile(e),tileInfoView:this._tileInfoView}),this.addAttachHandles(this._updatingHandles.add((()=>[this.layer?.activeLayer?.styleId,this.tileMatrixSet]),(()=>this.doRefresh()))),super.attach())}detach(){super.detach(),this._tileStrategy?.destroy(),this._fetchQueue?.destroy(),this._fetchQueue=this._tileStrategy=this._tileInfoView=null}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}supportsSpatialReference(e){return this.layer.activeLayer.tileMatrixSets?.some((t=>a(t.tileInfo?.spatialReference,e)))??!1}async doRefresh(){if(this.attached){if(this.suspended)return this._tileStrategy.clear(),void this.requestUpdate();this._fetchQueue.reset(),this._tileStrategy.refresh((e=>this._updatingHandles.addPromise(this._enqueueTileFetch(e))))}}acquireTile(e){const t=this._bitmapView.createTile(e),i=t.bitmap;return[i.x,i.y]=this._tileInfoView.getTileCoords(y,t.key),i.resolution=this._tileInfoView.getTileResolution(t.key),[i.width,i.height]=this._tileInfoView.tileInfo.size,this._updatingHandles.addPromise(this._enqueueTileFetch(t)),this._bitmapView.addChild(t),this.requestUpdate(),t}releaseTile(e){this._fetchQueue.abort(e.key.id),this._bitmapView.removeChild(e),e.once(\"detach\",(()=>e.destroy())),this.requestUpdate()}async fetchTile(e,t={}){const s=\"tilemapCache\"in this.layer?this.layer.tilemapCache:null,{signal:r,resamplingLevel:a=0}=t;if(!s)return this._fetchImage(e,r);const l=new c(0,0,0,0);let o;try{await s.fetchAvailabilityUpsample(e.level,e.row,e.col,l,{signal:r}),o=await this._fetchImage(l,r)}catch(n){if(i(n))throw n;if(a<3){const i=this._tileInfoView.getTileParentId(e.id);if(i){const s=new c(i),r=await this.fetchTile(s,{...t,resamplingLevel:a+1});return h(this._tileInfoView,r,s,e)}}throw n}return h(this._tileInfoView,o,l,e)}canResume(){const e=super.canResume();return e?null!==this.tileMatrixSet:e}async _enqueueTileFetch(e){if(!this._fetchQueue.has(e.key.id)){try{const t=await this._fetchQueue.push(e.key);e.bitmap.source=t,e.bitmap.width=this._tileInfoView.tileInfo.size[0],e.bitmap.height=this._tileInfoView.tileInfo.size[1],e.once(\"attach\",(()=>this.requestUpdate()))}catch(s){i(s)||t.getLogger(this).error(s)}this.requestUpdate()}}async _fetchImage(e,t){return this.layer.fetchImageBitmapTile(e.level,e.row,e.col,{signal:t})}_getTileMatrixSetBySpatialReference(e){const t=this.view.spatialReference;if(!e.tileMatrixSets)return null;let i=e.tileMatrixSets.find((e=>a(e.tileInfo?.spatialReference,t)));return!i&&t.isWebMercator&&(i=e.tileMatrixSets.find((e=>m.has(e.tileInfo?.spatialReference.wkid??-1)))),i}};e([s({readOnly:!0})],_.prototype,\"tileMatrixSet\",null),_=e([r(\"esri.views.2d.layers.WMTSLayerView2D\")],_);const w=_;export{w as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.29/esri/copyright.txt for details.\n*/\nfunction e(e){return e instanceof HTMLImageElement?e.naturalWidth:e.width}function t(e){return e instanceof HTMLImageElement?e.naturalHeight:e.height}function n(n,l,r,u){if(r.level===u.level)return l;const i=n.tileInfo.size,a=n.getTileResolution(r.level),c=n.getTileResolution(u.level);let g=n.getLODInfoAt(u.level);const h=g.getXForColumn(u.col),d=g.getYForRow(u.row);g=n.getLODInfoAt(r.level);const f=g.getXForColumn(r.col),s=g.getYForRow(r.row),m=e(l)/i[0],v=t(l)/i[1],w=Math.round(m*((h-f)/a)),I=Math.round(v*(-(d-s)/a)),M=Math.round(m*i[0]*(c/a)),F=Math.round(v*i[1]*(c/a)),L=o(i);return L.getContext(\"2d\").drawImage(l,w,I,M,F,0,0,i[0],i[1]),L}function o(e){const t=document.createElement(\"canvas\");return[t.width,t.height]=e,t}export{o as createBlankImage,n as resampleImage};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.29/esri/copyright.txt for details.\n*/\nimport{_ as r}from\"../../chunks/tslib.es6.js\";import e from\"../../core/Logger.js\";import{isAbortError as s}from\"../../core/promiseUtils.js\";import{on as o}from\"../../core/reactiveUtils.js\";import\"../../core/has.js\";import\"../../core/RandomLCG.js\";import\"../../core/Error.js\";import{subclass as t}from\"../../core/accessorSupport/decorators/subclass.js\";const i=i=>{let a=class extends i{initialize(){this.addHandles(o((()=>this.layer),\"refresh\",(r=>{this.doRefresh(r.dataChanged).catch((r=>{s(r)||e.getLogger(this).error(r)}))})),\"RefreshableLayerView\")}};return a=r([t(\"esri.layers.mixins.RefreshableLayerView\")],a),a};export{i as default};\n"],"names":["n","e","r","key","level","row","col","i","constructor","super","this","_tileInfoView","renderChildren","sortChildren","setStencilReference","createRenderParams","state","s","requiredLevel","getClosestInfoForScale","scale","displayLevel","tileInfo","scaleToZoom","prepareRenderPasses","push","registerRenderPass","name","brushes","drawPhase","DEBUG","MAP","HIGHLIGHT","LABEL","target","getStencilTarget","has","t","children","stencilRef","a","o","arguments","length","undefined","bitmap","coordScale","once","ready","destroy","beforeRender","afterRender","_createTransforms","displayViewScreenMat3","tileMat3","setTransform","transforms","onAttach","stage","onDetach","requiresDedicatedFBO","some","blendFunction","createTile","getTileBounds","getTileResolution","size","map","doRender","visible","attach","view","timeline","record","concat","layer","title","_bitmapView","container","addChild","detach","_this$_bitmapView","removeChild","removeAllChildren","m","Set","y","_","d","l","p","_tileStrategy","_fetchQueue","tileMatrixSet","_getTileMatrixSetBySpatialReference","activeLayer","id","tileMatrixSetId","update","pause","resume","_this$tileMatrixSet","u","tileInfoView","concurrency","process","fetchTile","f","cachePolicy","resampling","acquireTile","releaseTile","addAttachHandles","_updatingHandles","add","_this$layer","styleId","doRefresh","_this$_tileStrategy","_this$_fetchQueue","moveStart","requestUpdate","viewChange","moveEnd","supportsSpatialReference","_this$layer$activeLay","_this$layer$activeLay2","tileMatrixSets","_t$tileInfo","spatialReference","attached","suspended","clear","reset","refresh","addPromise","_enqueueTileFetch","x","getTileCoords","resolution","width","height","abort","tilemapCache","signal","resamplingLevel","_fetchImage","c","fetchAvailabilityUpsample","getTileParentId","h","canResume","source","getLogger","error","fetchImageBitmapTile","find","_e$tileInfo","isWebMercator","_e$tileInfo$spatialRe","_e$tileInfo2","wkid","readOnly","prototype","w","g","getLODInfoAt","getXForColumn","getYForRow","HTMLImageElement","naturalWidth","v","naturalHeight","Math","round","I","M","F","L","getContext","drawImage","document","createElement","initialize","addHandles","dataChanged","catch"],"sourceRoot":""}